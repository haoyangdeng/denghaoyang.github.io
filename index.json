[{"categories":["云计算"],"content":"etcd源码阅读","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"原理 etcd核心是分布式一致性协议算法raft，可以观看演示动画来理解raft算法。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:0:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"集群角色 raft算法中node的状态可以是跟随者(follower)、候选者(candidate)和领导者(leader) ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:1:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"集群初始化 集群初始化或者leader故障时，最开始的时候所有的节点都是follower状态，且都有一个随机的定时器。 该定时器按照周期检测leader的心跳信号，如果收到leader的心跳信号，则重置定时器。 如果超过定时器的时间还没有收到leader的心跳信号，则发起选举，切换成candidate状态，并向集群中其它节点发送请求投票(request vote)的信号。 其它节点则会在定时器超时的时候进行投票，若candidate收到半数以上(majority)的投票，则选举成功，切换成leader状态。 以上整个过程被称为leader election。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:2:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"提交信息 选举成功后，所有提交到集群的变化都要经过leader处理，也就是说，所有节点客户端的请求都会转发到leader节点。 所有的变化首先将会以条目(entry)的方式，存储到leader节点的日志(log)当中，但此时该条目是未提交(uncommit)的状态。 leader将会把该条未提交的条目向所有follwer节点发送，当收到半数以上的节点投票以后，leader会将该条目转换成commit状态，并通告(notify)所有的follower该条目变为commit状态。 以上整个过程被称为log replication。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:3:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"超时时间 第一个是选举超时(election timeout)，是一个介于150~300ms的随机值，超时则节点进入candidate状态，进入新的选举周期(election term)，请求其它节点投票，并将自己的票投给自己。 如果收到投票请求的节点在这个新的选举周期还没有投过票，则会将票投给请求的节点，并重置选举超时时间。 candidate变成leader后会定时发送附加条目信息(Append Entries messages)，其定时时间则是心跳超时时间(heartbeat timeout),follower会对每一条附加条目信息进行回复。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:4:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"超时重新选举 如果leader发送的间隔超过follower选举超时时间，则follower会变成candidate并开始新的选举周期重新选举。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:5:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"特殊情况 若两个candidate都得到了相同的票数，则不会选出leader，并等待下一个选举周期重新选举。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:6:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"变化的同步 通过用于心跳时间的附加条目信息一同发送到其它节点。 从客户端写到集群的过程可以描述为： 客户端发送请求Set–\u003eleader写log,此时是未提交状态–\u003efollower接受通知，并有半数以上投票–\u003eleader修改条目为提交状态–\u003e通知客户端和follower成功写入 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:7:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["云计算"],"content":"集群分区情况 在出现集群分区的情况时（集群节点由于某些原因被分到两个集群即脑裂情况），则节点数较少的集群由于投票数不会多于半数其修改都是未提交的状态，选举周期也不会变，节点数较多的可以正常工作，当整个集群恢复正常的时候，之前节点数较少集群的未提交修改变化会回退，这些节点由于选举周期低于大多数的集群则会退回follower的状态加入多数节点的集群，并且log会随之更新。 ","date":"2022-07-26","objectID":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/:8:0","tags":["etcd"],"title":"etcd源码阅读(一)","uri":"/etcd%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E4%B8%80/"},{"categories":["test categories"],"content":"test file","date":"2022-07-16","objectID":"/first_post/","tags":["test tag"],"title":"First_post","uri":"/first_post/"},{"categories":["test categories"],"content":"This file is for test. ","date":"2022-07-16","objectID":"/first_post/:0:0","tags":["test tag"],"title":"First_post","uri":"/first_post/"},{"categories":["Markdown"],"content":"Markdown语法","date":"2022-05-12","objectID":"/markdown_introduction/","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"markdown使用规则 参考资料Markdown 官方教程 ","date":"2022-05-12","objectID":"/markdown_introduction/:0:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"标题 使用符号井号#后面接标题字段，注意#和标题间要有空格,多个#代表几级标题，如 ## 标题就是上面标题的效果。 ","date":"2022-05-12","objectID":"/markdown_introduction/:1:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"段落 使用空白行将段落进行区分。 ","date":"2022-05-12","objectID":"/markdown_introduction/:2:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"换行 在一行的末尾添加两个或多个空格，然后按回车键。或者在句子的结尾使用\u003cbr\u003e来进行换行。 ","date":"2022-05-12","objectID":"/markdown_introduction/:3:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"强调 使用星号*或者下划线_来实现字体的加粗和斜体。 写法 效果 **word** word *word* word ***word*** word ","date":"2022-05-12","objectID":"/markdown_introduction/:4:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"块引用 使用大于号\u003e来对整句或者整段引用内容加以区分，多个大于号可以进行嵌套 引用内容 引用内容 ","date":"2022-05-12","objectID":"/markdown_introduction/:5:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"代码引用 使用`和`或者``和``对内容中引用代码加以区分 ","date":"2022-05-12","objectID":"/markdown_introduction/:6:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"分隔线 ***或者__或者---单独写一行，且前后均添加空白行 ","date":"2022-05-12","objectID":"/markdown_introduction/:7:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"链接 [超链接显示名](超链接地址 \"超链接title\") 使用\u003c\u003e可以直接将地址内容变为可点击内容 强调链接, 在链接语法前后增加星号。 要将链接表示为代码，请在方括号中添加反引号。 I love supporting the **[EFF](https://eff.org)**. This is the *[Markdown Guide](https://www.markdownguide.org)*. See the section on [`code`](#code). 渲染如下： I love supporting the EFF. This is the Markdown Guide. See the section on code. 链接中的空格使用%20代替以适用不同的Markdown应用程序 ","date":"2022-05-12","objectID":"/markdown_introduction/:8:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"图片链接 添加图像 ![这是图片](/assets/img/philly-magic-garden.jpg \"Magic Gardens\") 添加图像链接 [![沙漠中的岩石图片](/assets/img/shiprock.jpg \"Shiprock\")](https://markdown.com.cn) ","date":"2022-05-12","objectID":"/markdown_introduction/:9:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"},{"categories":["Markdown"],"content":"转义字符 除了使用\\来使用转义字符 ","date":"2022-05-12","objectID":"/markdown_introduction/:10:0","tags":["语法"],"title":"Markdown学习","uri":"/markdown_introduction/"}]